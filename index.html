<!DOCTYPE html>

<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>LogScan</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Barlow+Condensed:wght@400;600;700;900&display=swap');

:root{
â€“bg:#0d0f12;â€“surface:#161a1f;â€“surface2:#1e2430;â€“border:#2a3040;
â€“accent:#f97316;â€“accent2:#22c55e;â€“ml:#ffe600;â€“shopee:#ee4d2d;
â€“ali:#ff6a00;â€“text:#e8eaf0;â€“muted:#6b7280;â€“danger:#ef4444;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;overflow-x:hidden}
body{font-family:â€˜Barlow Condensedâ€™,sans-serif;background:var(â€“bg);color:var(â€“text);-webkit-tap-highlight-color:transparent}

/* â•â•â• CHECK-IN OVERLAY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#checkinOverlay{
position:fixed;inset:0;background:var(â€“bg);z-index:500;
display:flex;flex-direction:column;align-items:center;justify-content:flex-start;
overflow-y:auto;padding:0 0 30px;
}
#checkinOverlay.hidden{display:none}

.checkin-header{
width:100%;background:var(â€“surface);border-bottom:3px solid var(â€“accent);
padding:16px 20px;text-align:center;margin-bottom:24px;
}
.checkin-header h1{font-size:26px;font-weight:900;letter-spacing:2px}
.checkin-header h1 span{color:var(â€“accent)}
.checkin-header p{font-size:13px;color:var(â€“muted);font-family:â€˜Space Monoâ€™,monospace;margin-top:4px}

.checkin-body{width:100%;max-width:400px;padding:0 20px}

/* Selfie */
.selfie-area{
display:flex;flex-direction:column;align-items:center;gap:12px;
margin-bottom:20px;
}
.selfie-preview{
width:110px;height:110px;border-radius:50%;
border:3px solid var(â€“accent);
object-fit:cover;background:var(â€“surface2);
display:flex;align-items:center;justify-content:center;
font-size:44px;overflow:hidden;flex-shrink:0;
cursor:pointer;
}
.selfie-preview img{width:100%;height:100%;object-fit:cover;display:block}
.selfie-label{font-size:13px;color:var(â€“muted);font-family:â€˜Space Monoâ€™,monospace;text-align:center}
.selfie-btn{
display:flex;align-items:center;gap:6px;
background:var(â€“surface2);border:1px solid var(â€“border);
border-radius:6px;padding:8px 16px;cursor:pointer;
font-family:â€˜Barlow Condensedâ€™,sans-serif;font-size:15px;font-weight:700;
color:var(â€“text);text-transform:uppercase;
}

.checkin-field{margin-bottom:16px}
.checkin-field label{display:block;font-size:11px;color:var(â€“muted);letter-spacing:1px;text-transform:uppercase;margin-bottom:6px;font-family:â€˜Space Monoâ€™,monospace}
.checkin-field input,
.checkin-field select{
width:100%;background:var(â€“surface2);border:1px solid var(â€“border);
border-radius:8px;color:var(â€“text);
font-family:â€˜Barlow Condensedâ€™,sans-serif;font-size:20px;font-weight:700;
padding:12px 14px;appearance:none;outline:none;
transition:border-color .2s;
}
.checkin-field input:focus,
.checkin-field select:focus{border-color:var(â€“accent)}
.checkin-field .sel-wrap{position:relative}
.checkin-field .sel-wrap::after{content:â€˜â–¾â€™;position:absolute;right:12px;top:50%;transform:translateY(-50%);color:var(â€“accent);pointer-events:none;font-size:16px}

.btn-start-session{
width:100%;background:var(â€“accent);color:#000;
font-family:â€˜Barlow Condensedâ€™,sans-serif;font-size:22px;font-weight:900;
letter-spacing:1px;text-transform:uppercase;
border:none;border-radius:10px;padding:15px;cursor:pointer;
margin-top:8px;transition:opacity .15s;
}
.btn-start-session:disabled{opacity:.35;pointer-events:none}
.checkin-error{
text-align:center;color:var(â€“danger);font-size:13px;
margin-top:8px;font-family:â€˜Space Monoâ€™,monospace;
min-height:18px;
}

/* â•â•â• HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.header{
background:var(â€“surface);border-bottom:2px solid var(â€“accent);
padding:10px 14px;display:flex;align-items:center;justify-content:space-between;
position:sticky;top:0;z-index:100;
}
.header-logo{display:flex;align-items:center;gap:10px}
.logo-icon{width:36px;height:36px;background:var(â€“accent);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:18px}
.header h1{font-size:19px;font-weight:900;letter-spacing:1px;line-height:1}
.header h1 span{color:var(â€“accent)}
.header-right{display:flex;align-items:center;gap:8px}
.header-date{font-family:â€˜Space Monoâ€™,monospace;font-size:10px;color:var(â€“muted);text-align:right;white-space:pre}

/* Operator chip in header */
.operator-chip{
display:flex;align-items:center;gap:6px;
background:var(â€“surface2);border:1px solid var(â€“border);
border-radius:20px;padding:4px 10px 4px 5px;
cursor:pointer;transition:border-color .2s;
flex-shrink:0;
}
.operator-chip:active{border-color:var(â€“accent)}
.op-avatar{
width:26px;height:26px;border-radius:50%;
object-fit:cover;background:var(â€“border);
display:flex;align-items:center;justify-content:center;
font-size:14px;overflow:hidden;flex-shrink:0;
}
.op-avatar img{width:100%;height:100%;object-fit:cover;display:block}
.op-name{font-size:12px;font-weight:700;color:var(â€“text);max-width:80px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

/* â•â•â• LAYOUT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.main{padding:10px;max-width:600px;margin:0 auto}
.card{background:var(â€“surface);border:1px solid var(â€“border);border-radius:10px;margin-bottom:10px;overflow:hidden}
.card-header{padding:9px 13px;background:var(â€“surface2);border-bottom:1px solid var(â€“border);display:flex;align-items:center;gap:8px}
.card-header h2{font-size:13px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(â€“muted)}
.card-body{padding:12px}

/* â•â•â• SESSION CARD (driver locked) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.session-card{
background:var(â€“surface);border:1px solid var(â€“accent);
border-radius:10px;margin-bottom:10px;padding:10px 14px;
display:flex;align-items:center;justify-content:space-between;gap:10px;
}
.session-driver{display:flex;align-items:center;gap:8px}
.session-driver .lock-icon{font-size:18px}
.session-driver-name{font-size:19px;font-weight:900;color:var(â€“accent);letter-spacing:.5px}
.session-driver-sub{font-size:11px;color:var(â€“muted);font-family:â€˜Space Monoâ€™,monospace}
.session-badge{
background:rgba(249,115,22,.15);border:1px solid var(â€“accent);
border-radius:6px;padding:4px 10px;
font-size:12px;font-weight:700;color:var(â€“accent);
font-family:â€˜Space Monoâ€™,monospace;white-space:nowrap;
}

/* â•â•â• DRIVER SELECT (pre-session) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
select,input[type=â€œtextâ€]{
width:100%;background:var(â€“bg);border:1px solid var(â€“border);
border-radius:6px;color:var(â€“text);
font-family:â€˜Barlow Condensedâ€™,sans-serif;font-size:18px;font-weight:600;
padding:9px 11px;appearance:none;outline:none;transition:border-color .2s;
}
select:focus,input[type=â€œtextâ€]:focus{border-color:var(â€“accent)}
.select-wrap{position:relative}
.select-wrap::after{content:â€˜â–¾â€™;position:absolute;right:11px;top:50%;transform:translateY(-50%);color:var(â€“accent);pointer-events:none;font-size:15px}

/* â•â•â• TABS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tabs{display:flex;border-bottom:1px solid var(â€“border);background:var(â€“surface2);overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.tabs::-webkit-scrollbar{display:none}
.tab{padding:9px 12px;font-size:12px;font-weight:700;letter-spacing:.5px;text-transform:uppercase;cursor:pointer;color:var(â€“muted);border-bottom:2px solid transparent;white-space:nowrap;transition:color .15s;flex-shrink:0}
.tab.active{color:var(â€“accent);border-bottom-color:var(â€“accent)}
.tab-panel{display:none}
.tab-panel.active{display:block}

/* â•â•â• SCANNER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.scanner-wrap{position:relative}
#qr-reader{border:none!important;background:#000!important;border-radius:0;overflow:hidden}
#qr-reader video{width:100%!important;border-radius:0}
#qr-reader__scan_region{background:transparent!important}
#qr-reader__scan_region img{display:none!important}
#qr-reader__dashboard{background:var(â€“surface2)!important;border-top:1px solid var(â€“border)!important;padding:8px!important}
#qr-reader__dashboard button{background:var(â€“accent)!important;color:#000!important;font-weight:700!important;border:none!important;border-radius:6px!important;padding:8px 16px!important;font-family:â€˜Barlow Condensedâ€™,sans-serif!important;font-size:15px!important;cursor:pointer!important}
#qr-reader__dashboard select{background:var(â€“bg)!important;color:var(â€“text)!important;border:1px solid var(â€“border)!important;border-radius:5px!important;padding:6px!important;font-size:13px!important}
#qr-reader__status_span{color:var(â€“muted)!important;font-size:12px!important;font-family:â€˜Space Monoâ€™,monospace!important}
#qr-reader__camera_permission_button{background:var(â€“accent)!important;color:#000!important;font-weight:900!important;font-size:16px!important;padding:12px 24px!important;border-radius:8px!important;border:none!important;cursor:pointer!important;font-family:â€˜Barlow Condensedâ€™,sans-serif!important;width:100%!important}
#qr-reader__filescan_input{display:none!important}
#qr-reader__header_message{color:var(â€“text)!important;font-family:â€˜Space Monoâ€™,monospace!important;font-size:11px!important}

.scan-flash{position:absolute;inset:0;pointer-events:none;z-index:10;opacity:0}
.scan-flash.ok{animation:flashGreen .35s ease}
.scan-flash.dup{animation:flashOrange .35s ease}
@keyframes flashGreen{0%{background:rgba(34,197,94,.55);opacity:1}100%{opacity:0}}
@keyframes flashOrange{0%{background:rgba(249,115,22,.45);opacity:1}100%{opacity:0}}

.scan-status{
display:flex;align-items:center;gap:8px;padding:9px 12px;
background:var(â€“surface2);border-top:1px solid var(â€“border);
font-size:14px;font-weight:700;min-height:42px;
}
.scan-status .dot{width:10px;height:10px;border-radius:50%;flex-shrink:0;background:var(â€“muted)}
.scan-status.scanning .dot{background:var(â€“accent2);animation:pulse 1.4s ease infinite}
.scan-status.scanned .dot{background:var(â€“accent2)}
.scan-status.dup .dot{background:var(â€“accent)}
.scan-status.err .dot{background:var(â€“danger)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
.scan-status-text{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.scan-counter-badge{background:var(â€“accent);color:#000;font-family:â€˜Space Monoâ€™,monospace;font-size:13px;font-weight:700;padding:3px 8px;border-radius:4px;flex-shrink:0}

.manual-row{display:flex;gap:8px;margin-top:10px}
.manual-row input{font-size:15px;font-weight:400}

/* â•â•â• COUNTERS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.counters-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.counter-box{background:var(â€“bg);border:1px solid var(â€“border);border-radius:8px;padding:12px;text-align:center;position:relative;overflow:hidden}
.counter-box::before{content:â€™â€™;position:absolute;top:0;left:0;right:0;height:3px}
.counter-box.ml::before{background:var(â€“ml)}.counter-box.shopee::before{background:var(â€“shopee)}.counter-box.ali::before{background:var(â€“ali)}.counter-box.other::before{background:var(â€“muted)}
.counter-label{font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(â€“muted);margin-bottom:4px}
.counter-num{font-family:â€˜Space Monoâ€™,monospace;font-size:44px;font-weight:700;line-height:1}
.counter-box.ml .counter-num{color:var(â€“ml)}.counter-box.shopee .counter-num{color:var(â€“shopee)}.counter-box.ali .counter-num{color:var(â€“ali)}.counter-box.other .counter-num{color:var(â€“muted)}
.counter-box.bump{animation:bump .25s ease}
@keyframes bump{0%{transform:scale(1)}50%{transform:scale(1.08)}100%{transform:scale(1)}}
.total-box{background:var(â€“surface2);border:1px solid var(â€“accent);border-radius:8px;padding:11px 15px;display:flex;align-items:center;justify-content:space-between;margin-top:10px}
.total-label{font-size:14px;font-weight:700;letter-spacing:1px;color:var(â€“muted);text-transform:uppercase}
.total-num{font-family:â€˜Space Monoâ€™,monospace;font-size:36px;color:var(â€“accent)}

.scanned-list{max-height:180px;overflow-y:auto;display:flex;flex-direction:column;gap:5px;margin-top:6px}
.scanned-item{background:var(â€“bg);border:1px solid var(â€“border);border-radius:6px;padding:7px 10px;display:flex;align-items:center;gap:8px;font-size:12px;animation:slideIn .2s ease}
@keyframes slideIn{from{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translateY(0)}}
.badge{display:inline-block;padding:2px 6px;border-radius:4px;font-size:10px;font-weight:700;flex-shrink:0}
.badge-ml{background:var(â€“ml);color:#000}.badge-shopee{background:var(â€“shopee);color:#fff}.badge-ali{background:var(â€“ali);color:#fff}.badge-other{background:var(â€“muted);color:#fff}
.item-code{font-family:â€˜Space Monoâ€™,monospace;font-size:10px;color:var(â€“muted);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.item-del{background:none;border:none;color:var(â€“danger);cursor:pointer;font-size:15px;padding:2px 5px}
.item-time{font-size:10px;color:var(â€“border);white-space:nowrap}

/* â•â•â• PHOTOS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.photos-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:7px;margin-bottom:10px}
.photo-wrap{position:relative}
.photo-thumb{aspect-ratio:1;border-radius:6px;object-fit:cover;border:1px solid var(â€“border);width:100%;display:block;cursor:pointer}
.photo-del-btn{position:absolute;top:2px;right:2px;background:rgba(0,0,0,.75);border:none;border-radius:50%;width:22px;height:22px;color:#fff;font-size:11px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.photo-slot{aspect-ratio:1;border-radius:6px;border:1px dashed var(â€“border);display:flex;align-items:center;justify-content:center;color:var(â€“muted);font-size:22px;cursor:pointer}
.photo-slot.live{border-color:var(â€“accent);color:var(â€“accent)}
.photo-count{font-size:11px;color:var(â€“muted);text-align:right;margin-bottom:5px}

/* â•â•â• EXPORT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.summary-box{background:var(â€“bg);border:1px solid var(â€“border);border-radius:8px;padding:12px;font-family:â€˜Space Monoâ€™,monospace;font-size:12px;white-space:pre-wrap;color:var(â€“text);line-height:1.7}
.export-info{font-size:12px;color:var(â€“muted);font-family:â€˜Space Monoâ€™,monospace;margin-top:6px;padding:8px 10px;background:var(â€“surface2);border-radius:6px;border-left:3px solid var(â€“accent);line-height:1.6}

/* â•â•â• SETTINGS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.driver-tag{display:inline-flex;align-items:center;gap:5px;background:var(â€“surface2);border:1px solid var(â€“border);border-radius:20px;padding:4px 9px;font-size:12px;margin:3px}
.driver-tag button{background:none;border:none;color:var(â€“danger);cursor:pointer;font-size:13px;padding:0}
.add-driver-row{display:flex;gap:8px;margin-top:8px}
.add-driver-row input{font-size:15px}

/* â•â•â• BUTTONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:10px 16px;border-radius:6px;font-family:â€˜Barlow Condensedâ€™,sans-serif;font-size:15px;font-weight:700;letter-spacing:.5px;border:none;cursor:pointer;transition:all .15s;text-transform:uppercase}
.btn-primary{background:var(â€“accent);color:#000}.btn-success{background:var(â€“accent2);color:#000}.btn-danger{background:var(â€“danger);color:#fff}
.btn-ghost{background:var(â€“surface2);color:var(â€“text);border:1px solid var(â€“border)}
.btn-ghost:active{border-color:var(â€“accent);color:var(â€“accent)}
.btn-whatsapp{background:#25D366;color:#fff}.btn-full{width:100%}
.btn:disabled{opacity:.4;pointer-events:none}

.separator{height:1px;background:var(â€“border);margin:10px 0}
.label-small{font-size:11px;color:var(â€“muted);letter-spacing:1px;text-transform:uppercase;margin-bottom:4px}
.row{display:flex;gap:8px}
.empty-state{text-align:center;padding:18px;color:var(â€“muted);font-size:13px}
.empty-icon{font-size:30px;margin-bottom:6px}

/* â•â•â• BEEP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.beep-indicator{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);width:85px;height:85px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:38px;pointer-events:none;z-index:999}
.beep-indicator.show{animation:beepPop .45s ease forwards}
@keyframes beepPop{0%{transform:translate(-50%,-50%) scale(0);opacity:1}40%{transform:translate(-50%,-50%) scale(1.25);opacity:1}100%{transform:translate(-50%,-50%) scale(1.6);opacity:0}}
.beep-ml{background:rgba(255,230,0,.9)}.beep-shopee{background:rgba(238,77,45,.9)}.beep-ali{background:rgba(255,106,0,.9)}.beep-other{background:rgba(107,114,128,.9)}

/* â•â•â• SUCCESS OVERLAY (apÃ³s export) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#successOverlay{
position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:600;
display:none;align-items:center;justify-content:center;flex-direction:column;gap:16px;
padding:30px;text-align:center;
}
#successOverlay.show{display:flex}
.success-icon{font-size:72px;animation:popIn .4s ease}
@keyframes popIn{0%{transform:scale(0)}60%{transform:scale(1.2)}100%{transform:scale(1)}}
.success-title{font-size:28px;font-weight:900;color:var(â€“accent2);letter-spacing:1px}
.success-sub{font-size:15px;color:var(â€“muted);font-family:â€˜Space Monoâ€™,monospace;line-height:1.6}
.btn-new-session{
background:var(â€“accent);color:#000;font-family:â€˜Barlow Condensedâ€™,sans-serif;
font-size:20px;font-weight:900;text-transform:uppercase;letter-spacing:1px;
border:none;border-radius:10px;padding:14px 32px;cursor:pointer;margin-top:8px;
}

::-webkit-scrollbar{width:3px}::-webkit-scrollbar-track{background:var(â€“bg)}::-webkit-scrollbar-thumb{background:var(â€“border);border-radius:2px}
</style>

</head>
<body>

<!-- â•â•â• CHECK-IN OVERLAY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div id="checkinOverlay">
  <div class="checkin-header">
    <h1>LOG<span>SCAN</span></h1>
    <p>Identifique-se para iniciar a conferÃªncia</p>
  </div>
  <div class="checkin-body">

```
<div class="selfie-area">
  <div class="selfie-preview" id="selfiePreview" onclick="document.getElementById('selfieInput').click()">
    <span id="selfieIcon">ğŸ‘¤</span>
    <img id="selfieImg" style="display:none">
  </div>
  <div class="selfie-label">Toque para tirar sua foto</div>
  <label class="selfie-btn" onclick="document.getElementById('selfieInput').click()">
    ğŸ“· Tirar selfie
  </label>
  <input type="file" id="selfieInput" accept="image/*" capture="user" style="display:none" onchange="captureSelfie(this)">
</div>

<div class="checkin-field">
  <label>Seu nome (operador)</label>
  <input type="text" id="operatorName" placeholder="Ex: Ana Paula" oninput="validateCheckin()">
</div>

<div class="checkin-field">
  <label>Entregador desta remessa</label>
  <div class="sel-wrap">
    <select id="checkinDriverSelect" onchange="validateCheckin()">
      <option value="">â€” Selecione o entregador â€”</option>
    </select>
  </div>
</div>

<button class="btn-start-session" id="btnStartSession" disabled onclick="startSession()">
  â–¶ INICIAR CONFERÃŠNCIA
</button>
<div class="checkin-error" id="checkinError"></div>
```

  </div>
</div>

<!-- â•â•â• SUCCESS OVERLAY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div id="successOverlay">
  <div class="success-icon">âœ…</div>
  <div class="success-title">EXPORTADO!</div>
  <div class="success-sub" id="successSubText"></div>
  <button class="btn-new-session" onclick="newSession()">ğŸ”„ Nova conferÃªncia</button>
</div>

<!-- â•â•â• MAIN APP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div id="appRoot" style="display:none">

  <div class="header">
    <div class="header-logo">
      <div class="logo-icon">ğŸ“¦</div>
      <div>
        <h1>LOG<span>SCAN</span></h1>
        <div style="font-size:10px;color:var(--muted);font-family:'Space Mono',monospace">SCANNER CONTÃNUO</div>
      </div>
    </div>
    <div class="header-right">
      <div class="operator-chip" id="operatorChip">
        <div class="op-avatar" id="headerAvatar">ğŸ‘¤</div>
        <div class="op-name" id="headerOpName">â€”</div>
      </div>
      <div class="header-date" id="headerDate"></div>
    </div>
  </div>

  <div class="main">

```
<!-- SESSION LOCKED CARD -->
<div class="session-card" id="sessionCard">
  <div class="session-driver">
    <span class="lock-icon">ğŸ”’</span>
    <div>
      <div class="session-driver-name" id="sessionDriverName"></div>
      <div class="session-driver-sub">SessÃ£o em andamento</div>
    </div>
  </div>
  <div class="session-badge" id="sessionBadge">0 pacotes</div>
</div>

<!-- TABS -->
<div class="card" style="overflow:visible">
  <div class="tabs">
    <div class="tab active" onclick="switchTab('scanner')">ğŸ“· Scanner</div>
    <div class="tab" onclick="switchTab('count')">ğŸ“Š Contagem</div>
    <div class="tab" onclick="switchTab('photos')">ğŸ–¼ Fotos</div>
    <div class="tab" onclick="switchTab('export')">ğŸ“¤ Exportar</div>
    <div class="tab" onclick="switchTab('settings')">âš™ï¸ Config</div>
  </div>

  <!-- â”€â”€ SCANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="tab-panel active" id="tab-scanner">
    <div class="scanner-wrap">
      <div id="qr-reader"></div>
      <div class="scan-flash" id="scanFlash"></div>
    </div>
    <div class="scan-status" id="scanStatus">
      <div class="dot"></div>
      <div class="scan-status-text" id="scanStatusText">Iniciando cÃ¢mera...</div>
      <div class="scan-counter-badge" id="scanCounterBadge">0</div>
    </div>
    <div class="card-body" style="padding-top:10px">
      <div class="label-small">CÃ³digo manual</div>
      <div class="manual-row">
        <input type="text" id="manualInput" placeholder="Ex: BR2603126305985" onkeydown="if(event.key==='Enter')addManual()">
        <button class="btn btn-ghost" onclick="addManual()" style="white-space:nowrap;padding:9px 12px">+ Add</button>
      </div>
    </div>
  </div>

  <!-- â”€â”€ CONTAGEM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="tab-panel" id="tab-count">
    <div class="card-body">
      <div class="counters-grid">
        <div class="counter-box ml" id="box-ml"><div class="counter-label">Mercado Livre</div><div class="counter-num" id="cnt-ml">0</div></div>
        <div class="counter-box shopee" id="box-shopee"><div class="counter-label">Shopee</div><div class="counter-num" id="cnt-shopee">0</div></div>
        <div class="counter-box ali" id="box-ali"><div class="counter-label">AliExpress</div><div class="counter-num" id="cnt-ali">0</div></div>
        <div class="counter-box other" id="box-other"><div class="counter-label">Outros</div><div class="counter-num" id="cnt-other">0</div></div>
      </div>
      <div class="total-box"><span class="total-label">Total</span><span class="total-num" id="cnt-total">0</span></div>
      <div class="separator"></div>
      <div class="label-small">HistÃ³rico</div>
      <div class="scanned-list" id="scannedList"><div class="empty-state"><div class="empty-icon">ğŸ“­</div>Nenhum pacote ainda</div></div>
      <div style="margin-top:10px"><button class="btn btn-danger btn-full" onclick="clearAll()" style="font-size:13px">ğŸ—‘ Limpar tudo</button></div>
    </div>
  </div>

  <!-- â”€â”€ FOTOS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="tab-panel" id="tab-photos">
    <div class="card-body">
      <div class="photo-count" id="photoCount">0 / 8 fotos</div>
      <div class="photos-grid" id="photosGrid"></div>
      <input type="file" id="photoInput" accept="image/*" capture="environment" multiple onchange="addPhotos(this)" style="display:none">
      <button class="btn btn-ghost btn-full" onclick="document.getElementById('photoInput').click()" id="addPhotoBtn">ğŸ“¸ Tirar / Adicionar foto</button>
      <div style="margin-top:8px"><button class="btn btn-danger btn-full" onclick="clearPhotos()" style="font-size:13px">ğŸ—‘ Remover todas</button></div>
    </div>
  </div>

  <!-- â”€â”€ EXPORTAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="tab-panel" id="tab-export">
    <div class="card-body">
      <div class="label-small">Resumo da conferÃªncia</div>
      <div class="summary-box" id="summaryBox" style="margin-top:5px;margin-bottom:10px"></div>

      <div class="label-small">WhatsApp â€” nÃºmero destino</div>
      <input type="tel" id="waNumber" placeholder="5511999998888" style="margin-top:4px;margin-bottom:6px;font-size:15px">
      <div class="export-info">
        ğŸ“¸ As fotos serÃ£o compartilhadas junto com o resumo usando o compartilhamento nativo do iPhone.
      </div>

      <button class="btn btn-whatsapp btn-full" onclick="exportWhatsApp()" style="margin-top:10px;margin-bottom:8px;font-size:18px;padding:13px">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
        EXPORTAR PARA WHATSAPP
      </button>

      <div class="separator"></div>
      <div class="label-small">Google Sheets (opcional)</div>
      <input type="text" id="sheetsUrl" placeholder="https://script.google.com/macros/s/.../exec" style="margin-top:4px;margin-bottom:8px;font-size:12px">
      <button class="btn btn-success btn-full" onclick="exportSheets()" style="font-size:15px">ğŸ“Š Enviar para Google Sheets</button>
      <div id="sheetsStatus" style="margin-top:7px;font-size:13px;text-align:center;color:var(--muted)"></div>

      <div class="separator"></div>
      <button class="btn btn-ghost btn-full" onclick="exportTxt()" style="font-size:14px">ğŸ’¾ Baixar como .TXT</button>
    </div>
  </div>

  <!-- â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="tab-panel" id="tab-settings">
    <div class="card-body">
      <div class="label-small">Entregadores cadastrados</div>
      <div id="driversList" style="margin-top:6px;margin-bottom:4px"></div>
      <div class="add-driver-row">
        <input type="text" id="newDriverInput" placeholder="Nome do entregador..." style="font-size:15px">
        <button class="btn btn-primary" onclick="addDriver()" style="white-space:nowrap">+ Add</button>
      </div>
      <div class="separator"></div>
      <div class="label-small">Intervalo anti-duplicata (segundos)</div>
      <div class="row" style="margin-top:6px;align-items:center;gap:10px">
        <input type="range" id="refractorySlider" min="1000" max="10000" step="500" value="3000" style="flex:1;accent-color:var(--accent)" oninput="document.getElementById('refractoryLabel').textContent=(this.value/1000).toFixed(1)+'s'">
        <span id="refractoryLabel" style="font-family:'Space Mono',monospace;font-size:13px;color:var(--accent);white-space:nowrap">3.0s</span>
      </div>
      <div class="separator"></div>
      <div class="label-small" style="margin-bottom:8px">PadrÃµes de detecÃ§Ã£o</div>
      <div style="font-size:12px;color:var(--muted);font-family:'Space Mono',monospace;line-height:2.2">
        <div><span style="color:var(--ml)">â–  ML</span>  â€” 20000 Â· envioflex Â· mercadolivre Â· meli</div>
        <div><span style="color:var(--shopee)">â–  Shop</span> â€” BR+10~15dÃ­gitos Â· shopee</div>
        <div><span style="color:var(--ali)">â–  Ali</span>  â€” aliexpress Â· cainiao Â· AE+dÃ­gitos</div>
      </div>
    </div>
  </div>
</div><!-- end card -->
```

  </div><!-- end main -->
</div><!-- end appRoot -->

<div class="beep-indicator" id="beepEl"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let packages = [];
let photos = [];
let photoFiles = []; // raw File objects for Web Share API
let scannedCodes = new Set();
let drivers = JSON.parse(localStorage.getItem('lg_drivers') || '["JoÃ£o","Pedro","Carlos","Lucas","Marcos","Rafael"]');
let html5QrCode = null;
let scannerRunning = false;
let operatorName = '';
let operatorPhoto = ''; // base64
let currentDriver = '';
let sessionActive = false;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BOOT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.addEventListener('DOMContentLoaded', () => {
  updateDate();
  setInterval(updateDate, 30000);
  populateCheckinDrivers();
  renderDriversSettings();
  document.getElementById('waNumber').value = localStorage.getItem('lg_wa') || '';
  document.getElementById('sheetsUrl').value = localStorage.getItem('lg_sheets') || '';
  document.getElementById('waNumber').addEventListener('change', e => localStorage.setItem('lg_wa', e.target.value));
  document.getElementById('sheetsUrl').addEventListener('change', e => localStorage.setItem('lg_sheets', e.target.value));
  document.getElementById('checkinOverlay').classList.remove('hidden');
});

function updateDate() {
  const d = new Date();
  const el = document.getElementById('headerDate');
  if (el) el.textContent = d.toLocaleDateString('pt-BR') + '\n' + d.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHECK-IN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function populateCheckinDrivers() {
  const sel = document.getElementById('checkinDriverSelect');
  sel.innerHTML = '<option value="">â€” Selecione o entregador â€”</option>';
  drivers.forEach(d => {
    const o = document.createElement('option'); o.value = d; o.textContent = d; sel.appendChild(o);
  });
}

function captureSelfie(input) {
  const file = input.files[0]; if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    operatorPhoto = e.target.result;
    document.getElementById('selfieIcon').style.display = 'none';
    const img = document.getElementById('selfieImg');
    img.src = operatorPhoto; img.style.display = 'block';
  };
  reader.readAsDataURL(file);
  validateCheckin();
}

function validateCheckin() {
  const name = document.getElementById('operatorName').value.trim();
  const driver = document.getElementById('checkinDriverSelect').value;
  const ok = name.length > 1 && driver;
  document.getElementById('btnStartSession').disabled = !ok;
}

function startSession() {
  operatorName = document.getElementById('operatorName').value.trim();
  currentDriver = document.getElementById('checkinDriverSelect').value;
  if (!operatorName || !currentDriver) return;
  sessionActive = true;

  // Show app
  document.getElementById('checkinOverlay').classList.add('hidden');
  document.getElementById('appRoot').style.display = 'block';

  // Header operator chip
  document.getElementById('headerOpName').textContent = operatorName;
  if (operatorPhoto) {
    const av = document.getElementById('headerAvatar');
    av.innerHTML = `<img src="${operatorPhoto}">`;
  }

  // Session card
  document.getElementById('sessionDriverName').textContent = currentDriver;
  document.getElementById('sessionBadge').textContent = '0 pacotes';

  // Init scanner
  html5QrCode = new Html5Qrcode('qr-reader', { verbose: false });
  startScanner();

  // Render photos grid
  renderPhotosGrid();
  updateSummary();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCANNER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startScanner() {
  if (scannerRunning) return;
  setStatus('scanning', 'ğŸ“¡ Iniciando cÃ¢mera...');

  html5QrCode.start(
    { facingMode: 'environment' },
    { fps: 15, qrbox: { width: 240, height: 240 }, rememberLastUsedCamera: true,
      experimentalFeatures: { useBarCodeDetectorIfSupported: true } },
    onScanSuccess,
    () => {}
  ).then(() => {
    scannerRunning = true;
    setStatus('scanning', 'ğŸŸ¢ Escaneando â€” aponte para o QR code');
  }).catch(err => {
    setStatus('err', 'âŒ ' + (err.message || String(err)));
  });
}

function onScanSuccess(decodedText) {
  const code = decodedText.trim();
  if (scannedCodes.has(code)) {
    flashScan('dup'); setStatus('dup', 'âš ï¸ JÃ¡ escaneado: ' + code.substring(0,22));
    playDupBeep(); return;
  }
  addPackage(code, detectMP(code));
  flashScan('ok');
}

function flashScan(type) {
  const el = document.getElementById('scanFlash');
  el.className = 'scan-flash'; void el.offsetWidth; el.className = 'scan-flash ' + type;
}

function setStatus(state, text) {
  const el = document.getElementById('scanStatus');
  el.className = 'scan-status ' + state;
  document.getElementById('scanStatusText').textContent = text;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MARKETPLACE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function detectMP(code) {
  const c = code.toLowerCase();
  if (c.includes('mercadolivre')||c.includes('mercadolibre')||c.includes('meli.')||
      c.includes('envioflex')||c.includes('envio flex')||c.includes('20000')||
      c.includes('pack id')||/\bmlb\d+/i.test(code)) return 'ml';
  if (c.includes('shopee')||/^br\d{10,15}$/i.test(code.trim())) return 'shopee';
  if (c.includes('aliexpress')||c.includes('cainiao')||c.includes('ali.com')||
      /^ae\d+/i.test(code)) return 'ali';
  return 'other';
}
const mpLabel = mp => ({ml:'ML',shopee:'Shopee',ali:'Ali',other:'Outro'}[mp]);
const mpEmoji = mp => ({ml:'ğŸŸ¡',shopee:'ğŸ”´',ali:'ğŸŸ ',other:'âšª'}[mp]);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ADD PACKAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addPackage(code, mp) {
  const now = new Date();
  packages.push({ code, mp, driver: currentDriver, time: now.toISOString() });
  scannedCodes.add(code);
  updateCounters(mp);
  renderScannedList();
  showBeep(mp);
  playBeep();
  const t = now.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
  setStatus('scanned', `${mpEmoji(mp)} ${mpLabel(mp)} â€” ${code.length>24?code.substring(0,24)+'â€¦':code}`);
  document.getElementById('scanCounterBadge').textContent = packages.length;
  document.getElementById('sessionBadge').textContent = packages.length + ' pacote' + (packages.length !== 1 ? 's' : '');
}

function addManual() {
  const inp = document.getElementById('manualInput');
  const code = inp.value.trim(); if (!code) return;
  if (scannedCodes.has(code)) { setStatus('dup','âš ï¸ CÃ³digo jÃ¡ registrado!'); return; }
  addPackage(code, detectMP(code)); inp.value = '';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COUNTERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateCounters(lastMp) {
  const c = {ml:0,shopee:0,ali:0,other:0};
  packages.forEach(p => c[p.mp]++);
  ['ml','shopee','ali','other'].forEach(k => document.getElementById('cnt-'+k).textContent = c[k]);
  document.getElementById('cnt-total').textContent = packages.length;
  if (lastMp) {
    const box = document.getElementById('box-'+lastMp);
    box.classList.remove('bump'); void box.offsetWidth; box.classList.add('bump');
    setTimeout(() => box.classList.remove('bump'), 300);
  }
}

function renderScannedList() {
  const list = document.getElementById('scannedList');
  if (!packages.length) { list.innerHTML='<div class="empty-state"><div class="empty-icon">ğŸ“­</div>Nenhum pacote ainda</div>'; return; }
  list.innerHTML = '';
  [...packages].reverse().forEach((pkg,ri) => {
    const i = packages.length-1-ri;
    const t = new Date(pkg.time).toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
    const div = document.createElement('div'); div.className='scanned-item';
    div.innerHTML=`<span class="badge badge-${pkg.mp}">${mpLabel(pkg.mp)}</span><span class="item-code">${pkg.code}</span><span class="item-time">${t}</span><button class="item-del" onclick="removePackage(${i})">âœ•</button>`;
    list.appendChild(div);
  });
}

function removePackage(i) {
  scannedCodes.delete(packages[i].code); packages.splice(i,1);
  updateCounters(null); renderScannedList();
  document.getElementById('scanCounterBadge').textContent = packages.length;
  document.getElementById('sessionBadge').textContent = packages.length + ' pacote' + (packages.length!==1?'s':'');
}

function clearAll() {
  if (!confirm('Limpar todos os pacotes?')) return;
  packages=[]; scannedCodes=new Set(); updateCounters(null); renderScannedList();
  document.getElementById('scanCounterBadge').textContent='0';
  document.getElementById('sessionBadge').textContent='0 pacotes';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SOUNDS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function playBeep() {
  try {
    const ctx = new (window.AudioContext||window.webkitAudioContext)();
    [880,1100].forEach((freq,i) => {
      const osc=ctx.createOscillator(), g=ctx.createGain();
      osc.connect(g); g.connect(ctx.destination); osc.type='sine'; osc.frequency.value=freq;
      const s=ctx.currentTime+i*0.07;
      g.gain.setValueAtTime(0,s); g.gain.linearRampToValueAtTime(0.4,s+0.01); g.gain.exponentialRampToValueAtTime(0.001,s+0.12);
      osc.start(s); osc.stop(s+0.13);
    });
  } catch(e){}
}
function playDupBeep() {
  try {
    const ctx=new (window.AudioContext||window.webkitAudioContext)();
    const osc=ctx.createOscillator(),g=ctx.createGain();
    osc.connect(g); g.connect(ctx.destination); osc.type='sawtooth'; osc.frequency.value=280;
    g.gain.setValueAtTime(0.3,ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.25);
    osc.start(ctx.currentTime); osc.stop(ctx.currentTime+0.25);
  } catch(e){}
}
function showBeep(mp) {
  const el=document.getElementById('beepEl');
  el.className='beep-indicator beep-'+mp; el.textContent=mpEmoji(mp);
  void el.offsetWidth; el.classList.add('show');
  setTimeout(()=>el.classList.remove('show'),500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(name) {
  const names=['scanner','count','photos','export','settings'];
  document.querySelectorAll('.tab').forEach((t,i)=>t.classList.toggle('active',names[i]===name));
  document.querySelectorAll('.tab-panel').forEach(p=>p.classList.toggle('active',p.id==='tab-'+name));
  if(name==='export') updateSummary();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PHOTOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addPhotos(input) {
  Array.from(input.files).forEach(file => {
    if (photos.length >= 8) return;
    photoFiles.push(file); // keep raw file for Web Share
    const r=new FileReader();
    r.onload=e=>{ photos.push(e.target.result); renderPhotosGrid(); };
    r.readAsDataURL(file);
  });
  input.value='';
}
function renderPhotosGrid() {
  const grid=document.getElementById('photosGrid'); grid.innerHTML='';
  photos.forEach((src,i)=>{
    const w=document.createElement('div'); w.className='photo-wrap';
    w.innerHTML=`<img src="${src}" class="photo-thumb"><button class="photo-del-btn" onclick="removePhoto(${i})">âœ•</button>`;
    w.querySelector('img').onclick=()=>{ const p=window.open(); p.document.write(`<img src="${src}" style="max-width:100%">`); };
    grid.appendChild(w);
  });
  for(let i=photos.length;i<8;i++){
    const s=document.createElement('div');
    s.className='photo-slot'+(i===photos.length?' live':'');
    s.textContent=i===photos.length?'+':'â—‹';
    if(i===photos.length) s.onclick=()=>document.getElementById('photoInput').click();
    grid.appendChild(s);
  }
  document.getElementById('photoCount').textContent=`${photos.length} / 8 fotos`;
  document.getElementById('addPhotoBtn').disabled=photos.length>=8;
}
function removePhoto(i){
  photos.splice(i,1); photoFiles.splice(i,1); renderPhotosGrid();
}
function clearPhotos(){ if(confirm('Remover todas as fotos?')){ photos=[]; photoFiles=[]; renderPhotosGrid(); } }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXPORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildSummary() {
  const d = new Date();
  const c = {ml:0,shopee:0,ali:0,other:0}; packages.forEach(p=>c[p.mp]++);
  return [
    'ğŸ“¦ CONFERÃŠNCIA DE PACOTES',
    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',
    `ğŸ—“ ${d.toLocaleDateString('pt-BR')} ${d.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'})}`,
    `ğŸšš Entregador: ${currentDriver}`,
    `ğŸ‘¤ Operador: ${operatorName}`,
    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',
    `ğŸŸ¡ Mercado Livre: ${c.ml}`,
    `ğŸ”´ Shopee:        ${c.shopee}`,
    `ğŸŸ  AliExpress:    ${c.ali}`,
    `âšª Outros:        ${c.other}`,
    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',
    `ğŸ“¦ TOTAL: ${packages.length} pacotes`,
    `ğŸ“¸ Fotos: ${photos.length}`
  ].join('\n');
}

function updateSummary() {
  const el = document.getElementById('summaryBox');
  if (el) el.textContent = buildSummary();
}

// â”€â”€ WHATSAPP EXPORT (Web Share API â€” envia texto + fotos reais) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function exportWhatsApp() {
  const num = (document.getElementById('waNumber').value || '').replace(/\D/g,'');
  const summary = buildSummary();
  localStorage.setItem('lg_wa', num);

  // Try Web Share API first (iOS 15+, supports files)
  if (navigator.canShare && photoFiles.length > 0) {
    try {
      // Convert base64 photos back to files if needed
      const shareFiles = photoFiles.length > 0 ? photoFiles : await base64ToFiles();
      const canShare = navigator.canShare({ files: shareFiles, text: summary });
      if (canShare) {
        await navigator.share({ files: shareFiles, text: summary });
        showSuccessAndReset(summary);
        return;
      }
    } catch(err) {
      if (err.name === 'AbortError') return; // user cancelled â€” don't proceed
    }
  }

  // Fallback: Web Share without files (text only)
  if (navigator.share) {
    try {
      await navigator.share({ text: summary });
      showSuccessAndReset(summary);
      return;
    } catch(err) {
      if (err.name === 'AbortError') return;
    }
  }

  // Last fallback: wa.me link (no white screen â€” uses location.href)
  if (num) {
    const url = 'https://wa.me/' + num + '?text=' + encodeURIComponent(summary);
    const a = document.createElement('a');
    a.href = url; a.target = '_blank'; a.rel = 'noopener';
    document.body.appendChild(a); a.click(); document.body.removeChild(a);
    // Show success after brief delay
    setTimeout(() => showSuccessAndReset(summary), 800);
  } else {
    // No number â€” just share text via system share sheet
    if (navigator.share) {
      await navigator.share({ text: summary });
    } else {
      // Copy to clipboard
      await navigator.clipboard.writeText(summary).catch(()=>{});
      alert('Texto copiado! Cole no WhatsApp manualmente.');
    }
    showSuccessAndReset(summary);
  }
}

async function base64ToFiles() {
  return Promise.all(photos.map(async (b64, i) => {
    const res = await fetch(b64);
    const blob = await res.blob();
    return new File([blob], `foto_${i+1}.jpg`, { type: blob.type || 'image/jpeg' });
  }));
}

// â”€â”€ SHEETS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function exportSheets() {
  const url = document.getElementById('sheetsUrl').value.trim();
  if (!url) { document.getElementById('sheetsStatus').textContent='âš ï¸ Configure a URL'; document.getElementById('sheetsStatus').style.color='var(--danger)'; return; }
  localStorage.setItem('lg_sheets', url);
  const d=new Date(), c={ml:0,shopee:0,ali:0,other:0}; packages.forEach(p=>c[p.mp]++);
  const payload={ timestamp:d.toISOString(), date:d.toLocaleDateString('pt-BR'), time:d.toLocaleTimeString('pt-BR'), driver:currentDriver, operator:operatorName, ml:c.ml, shopee:c.shopee, aliexpress:c.ali, other:c.other, total:packages.length, photos:photos.length, codes:packages.map(p=>p.code).join('|') };
  document.getElementById('sheetsStatus').textContent='â³ Enviando...'; document.getElementById('sheetsStatus').style.color='var(--muted)';
  try {
    await fetch(url,{method:'POST',mode:'no-cors',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
    document.getElementById('sheetsStatus').textContent='âœ… Enviado com sucesso!'; document.getElementById('sheetsStatus').style.color='var(--accent2)';
  } catch(e) {
    document.getElementById('sheetsStatus').textContent='âŒ '+e.message; document.getElementById('sheetsStatus').style.color='var(--danger)';
  }
}

function exportTxt() {
  const d=new Date(), fn=`pacotes_${currentDriver.replace(/\s+/g,'_')}_${d.toLocaleDateString('pt-BR').replace(/\//g,'-')}.txt`;
  const content=buildSummary()+'\n\n--- CÃ“DIGOS ---\n'+packages.map(p=>`${mpLabel(p.mp)}: ${p.code}`).join('\n');
  const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([content],{type:'text/plain'})); a.download=fn; a.click();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SUCCESS + RESET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showSuccessAndReset(summary) {
  const c = {ml:0,shopee:0,ali:0,other:0}; packages.forEach(p=>c[p.mp]++);
  document.getElementById('successSubText').textContent =
    `Entregador: ${currentDriver}\nTotal: ${packages.length} pacotes\nML: ${c.ml} Â· Shopee: ${c.shopee} Â· Ali: ${c.ali}`;
  document.getElementById('successOverlay').classList.add('show');
}

function newSession() {
  // Hide success overlay
  document.getElementById('successOverlay').classList.remove('show');

  // Reset state (keep operator â€” just new driver/packages)
  packages = []; photos = []; photoFiles = []; scannedCodes = new Set();
  currentDriver = '';

  // Reset UI counters
  updateCounters(null); renderScannedList(); renderPhotosGrid();
  document.getElementById('scanCounterBadge').textContent = '0';
  document.getElementById('sheetsStatus').textContent = '';

  // Keep camera running â€” just reset status text
  setStatus('scanning', 'ğŸŸ¢ Escaneando â€” aponte para o QR code');
  switchTab('scanner');

  // Show check-in again for new driver selection
  // But keep operator (don't re-ask name/selfie)
  // Instead: show a quick driver picker modal inline
  showDriverPicker();
}

function showDriverPicker() {
  // Reuse check-in overlay but hide selfie + name fields
  const overlay = document.getElementById('checkinOverlay');
  document.querySelector('.selfie-area').style.display = 'none';
  document.getElementById('operatorName').closest('.checkin-field').style.display = 'none';
  document.querySelector('.checkin-header p').textContent = `Operador: ${operatorName} â€” selecione o prÃ³ximo entregador`;

  // Reset driver select
  document.getElementById('checkinDriverSelect').value = '';
  document.getElementById('btnStartSession').disabled = true;
  document.getElementById('btnStartSession').textContent = 'â–¶ PRÃ“XIMA CONFERÃŠNCIA';

  // Override start session for this case
  document.getElementById('btnStartSession').onclick = startNextSession;

  overlay.classList.remove('hidden');
  document.getElementById('appRoot').style.display = 'none';
}

function startNextSession() {
  currentDriver = document.getElementById('checkinDriverSelect').value;
  if (!currentDriver) return;

  document.getElementById('checkinOverlay').classList.add('hidden');
  document.getElementById('appRoot').style.display = 'block';

  // Restore hidden fields for future
  document.querySelector('.selfie-area').style.display = 'flex';
  document.getElementById('operatorName').closest('.checkin-field').style.display = 'block';
  document.querySelector('.checkin-header p').textContent = 'Identifique-se para iniciar a conferÃªncia';
  document.getElementById('btnStartSession').textContent = 'â–¶ INICIAR CONFERÃŠNCIA';
  document.getElementById('btnStartSession').onclick = startSession;

  // Update session card
  document.getElementById('sessionDriverName').textContent = currentDriver;
  document.getElementById('sessionBadge').textContent = '0 pacotes';

  updateSummary();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETTINGS â€” DRIVERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDriversSettings() {
  const list = document.getElementById('driversList'); list.innerHTML='';
  drivers.forEach((d,i)=>{
    const t=document.createElement('span'); t.className='driver-tag';
    t.innerHTML=`${d} <button onclick="removeDriver(${i})">Ã—</button>`;
    list.appendChild(t);
  });
  localStorage.setItem('lg_drivers', JSON.stringify(drivers));
  populateCheckinDrivers();
}
function addDriver() {
  const inp=document.getElementById('newDriverInput'), name=inp.value.trim();
  if(!name||drivers.includes(name)) return;
  drivers.push(name); renderDriversSettings(); inp.value='';
}
function removeDriver(i){ drivers.splice(i,1); renderDriversSettings(); }
</script>

</body>
</html>